@page "/HSAdmin"
@using ArcaneLibs.Extensions
@using LibMatrix.Responses.Federation
<h3>Homeserver Admininistration</h3>
<hr/>

@if (Homeserver is null) {
    <p>Homeserver is null...</p>
}
else {
    @if (Homeserver is AuthenticatedHomeserverSynapse) {
        <h4>Synapse tools</h4>
        <hr/>
        <a href="/HSAdmin/Synapse/RoomQuery">Query rooms</a><br/>
        <a href="/HSAdmin/Synapse/UserQuery">Query users</a><br/>
        <a href="/HSAdmin/Synapse/BlockMedia">Block media</a><br/>
        <a href="/HSAdmin/Synapse/BackgroundJobs">View running background jobs</a><br/>
    }
    else if (Homeserver is AuthenticatedHomeserverHSE) {
        <h4>Rory&amp;::LibMatrix.HomeserverEmulator tools</h4>
        <hr/>
        <a href="/HSAdmin/HSE/ManageExternalProfiles">Manage external profiles</a>
    }
    else {
        <p>Homeserver type @Homeserver.GetType().Name does not have any administration tools in RMU.</p>
        <p>Server info:</p>
        <pre>@ServerVersionResponse?.ToJson(ignoreNull: true)</pre>
    }
}

@code {
    public AuthenticatedHomeserverGeneric? Homeserver { get; set; }
    public ServerVersionResponse? ServerVersionResponse { get; set; }

    protected override async Task OnInitializedAsync() {
        Homeserver = await sessionStore.GetCurrentHomeserver(navigateOnFailure: true);
        if (Homeserver is null) return;
        ServerVersionResponse = await (Homeserver.FederationClient?.GetServerVersionAsync() ?? Task.FromResult<ServerVersionResponse?>(null));
        await base.OnInitializedAsync();
    }

}