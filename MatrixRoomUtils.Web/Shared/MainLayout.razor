@using System.Net
@inherits LayoutComponentBase

<div class="page">
    <div class="sidebar">
        <NavMenu/>
    </div>

    <main>
        <div class="top-row px-4">
            <PortableDevTools></PortableDevTools>
            <a href="https://git.rory.gay/MatrixRoomUtils.git/" target="_blank">Git</a>
            <a href="https://matrix.to/#/%23mru%3Arory.gay?via=rory.gay&via=matrix.org&via=feline.support" target="_blank">Matrix</a>
            @if (showDownload) {
                <a href="/MRU.tar.xz" target="_blank">Download</a>
            }
        </div>

        <article class="Content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    private bool showDownload { get; set; }

    protected override async Task OnInitializedAsync() {
        using var hc = new HttpClient();
        var hr = await hc.SendAsync(new HttpRequestMessage(HttpMethod.Head, NavigationManager.ToAbsoluteUri("/MRU-BIN.tar.xz").AbsoluteUri));
        showDownload = hr.StatusCode == HttpStatusCode.OK;

        await LocalStorageWrapper.LoadFromLocalStorage(LocalStorage);
        if (!LocalStorageWrapper.Settings.DeveloperSettings.EnableConsoleLogging) {
            Console.WriteLine("Console logging disabled!");
            var sw = new StringWriter();
            Console.SetOut(sw);
            Console.SetError(sw);
        }

        await base.OnInitializedAsync();
    }

}